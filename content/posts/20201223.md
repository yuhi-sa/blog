---
title: "Pythonでslackに実験結果(テキストと画像)を送る"
date: 2020-12-23T15:17:23+09:00
draft: false
tags: ["python"] 
---

# テキストを送る
## slack側のAPIを設定
1. slackの「設定と管理」から「アプリを管理する」を開く．
![fig1.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/96643542-efd5-e77c-4dae-eecf294b8fda.png)
2. Appディレクトリ[Incoming Webhook](https://slack.com/intl/ja-jp/help/articles/115005265063-Slack-%E3%81%A7%E3%81%AE-Incoming-Webhook-%E3%81%AE%E5%88%A9%E7%94%A8)を検索して追加する．
![fig2.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/b9d325c8-15aa-b30f-0d5c-b8680783c0e2.png)
![fig3.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/039ca03a-c501-4633-e558-4f3ae298b795.png)
3. チャンネルを選択して，「Incoming Webhookインテグレーションの追加」
![fig4.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/355e3b78-c341-180c-5aaf-e78357fac872.png)
4. 「Webhook URL」をコピーする．
![fig5.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/65d43347-2785-2dba-7772-4df8d0d1f2d8.png)
5. botのアイコンと名前をここで変更できる．
![fig8.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/f6b24c15-2254-32b3-3a0b-b7146ed7e8e8.png)

## コード

```python
import slackweb
slack = slackweb.Slack(url="コピーした Webhook URL")

def notify(title, text, color):
    attachments = [{"title": title,
                "text": text,
                "color": color, #good, warning, danger
                "footer": "Send from Python",
                }]
    slack.notify(text=None, attachments=attachments)

notify("テスト","おはよう","good")
notify("テスト","こんにちは","warning")
notify("テスト","こんばんは","danger")
```
attachmentsの構文は，以下を参考
- [Creating rich message layouts](https://api.slack.com/messaging/composing/layouts)
- [Slack API attachmentsチートシート](https://qiita.com/daikiojm/items/759ea40c00f9b539a4c8)
## 実行結果
![fig11.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/c6783b37-e033-42d1-5d93-a57294c90d5f.png)

# 画像を送る
- slack側のAPIを設定
1. 上記の1から2と同様にして「Bots」を追加する．
2. API トークンをコピーする．

## コード

```python
import requests
import json

def notifyImg(title, imageURL):
        files = {'file': open(imageURL, 'rb')}
        param = {
        'token': "コピーした APIトークン", 
        'channels':'投稿したいチャンネル名',
        'filename':"filename",
        'title': title,
        }
        requests.post(url="https://slack.com/api/files.upload",params=param, files=files)

notifyImg("テスト画像", "test.png") #imageURLは，ファイルパス

```
[ファイルパスとは](http://kuralab.jugem.jp/?eid=41#:~:text=%E9%96%8B%E9%96%89%E3%83%9C%E3%82%BF%E3%83%B3%E3%80%8D%20%3E%3E-,%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%83%91%E3%82%B9%EF%BC%88File%20Path%EF%BC%89%E3%81%A8%E3%81%AF%E3%80%81%E3%83%95%E3%82%A1%E3%82%A4%E3%83%AB%E3%81%8C%E3%81%82%E3%82%8B,%E6%96%87%E5%AD%97%E5%88%97%E3%81%AE%E3%81%93%E3%81%A8%E3%81%A7%E3%81%99%E3%80%82)

## 実行結果
![fig10.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/19164653-10d7-a78e-3bfd-0accc1475960.png)

# 終わりに
実験が終わったのを通知するのにプラスして，結果も送ってくれたらいいなあーと思って，slackのAPI調べたのでまとめてみました．間違いとかあったらごめんなさい．

![fig12.png](https://qiita-image-store.s3.ap-northeast-1.amazonaws.com/0/689163/1d3ac373-15b9-1d80-cc95-7b647a94525f.png)


# 参考
- [Python3でslackに投稿する](https://qiita.com/shtnkgm/items/4f0e4dcbb9eb52fdf316)
- [プログラムからSlackに画像投稿する方法まとめ](https://qiita.com/stkdev/items/992921572eefc7de4ad8)
